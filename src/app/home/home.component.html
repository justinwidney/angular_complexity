<goa-container accent="thin" padding="relaxed" width="full">

  <div class="flex-container">

    <!-- First Row: Dropdowns + Chart Type -->
    <div class="row">
      <div class="col-8">
        <div class="row">
          <div class="col">
            <div class="data-setting-wrapper">
              <div class="data-setting-component">
                <goa-form-item label="Region" labelSize="regular">
                  <goa-dropdown name="region" value="" 
                  matTooltip="Select region" 
                  matTooltipPosition="above" 
                  value="Alberta" 
                  width="180px"
                  (_change)="onChange($event, 'region')"
                  >
                  <goa-dropdown-item value="Alberta" label="Alberta"></goa-dropdown-item>
                  <goa-dropdown-item value="Canada" label="Canada"></goa-dropdown-item>
                  <goa-dropdown-item value="British Columbia" label="British Columbia"></goa-dropdown-item>
                  <goa-dropdown-item value="Manitoba" label="Manitoba"></goa-dropdown-item>
                  <goa-dropdown-item value="New Brunswick" label="New Brunswick"></goa-dropdown-item>
                  <goa-dropdown-item value="Newfoundland and Labrador" label="Newfoundland and Labrador"></goa-dropdown-item>
                  <goa-dropdown-item value="Nova Scotia" label="Nova Scotia"></goa-dropdown-item>
                  <goa-dropdown-item value="Ontario" label="Ontario"></goa-dropdown-item>
                  <goa-dropdown-item value="Prince Edward Island" label="Prince Edward Island"></goa-dropdown-item>
                  <goa-dropdown-item value="Quebec" label="Quebec"></goa-dropdown-item>
                  <goa-dropdown-item value="Saskatchewan" label="Saskatchewan"></goa-dropdown-item>
                  </goa-dropdown>
                </goa-form-item>
              </div>
            </div>
          </div>
          
          <goa-spacer hspacing="m"></goa-spacer>

          <div class="col">
            <div class="data-setting-wrapper">
              <div class="data-setting-component">
                <goa-form-item label="Year" labelSize="regular">
                  <goa-dropdown name="year" 
                  value="" 
                  matTooltip="Select year" 
                  matTooltipPosition="above" 
                  value="2023" 
                  width="180px"
                  (_change)="onChange($event, 'year')"
                  >
                  <goa-dropdown-item value="2023" label="2023"></goa-dropdown-item>
                  <goa-dropdown-item value="2022" label="2022"></goa-dropdown-item>
                  <goa-dropdown-item value="2021" label="2021"></goa-dropdown-item>
                  <goa-dropdown-item value="2020" label="2020"></goa-dropdown-item>
                  <goa-dropdown-item value="2019" label="2019"></goa-dropdown-item>
                  <goa-dropdown-item value="2018" label="2018"></goa-dropdown-item>
                  <goa-dropdown-item value="2017" label="2017"></goa-dropdown-item>
                  <goa-dropdown-item value="2016" label="2016"></goa-dropdown-item>
                  <goa-dropdown-item value="2015" label="2015"></goa-dropdown-item>
                  <goa-dropdown-item value="2014" label="2014"></goa-dropdown-item>
                  </goa-dropdown>
                </goa-form-item>
              </div>
            </div>
          </div>

          <goa-spacer hspacing="m"></goa-spacer>

          <div class="col">
            <div class="data-setting-wrapper">
              <div class="data-setting-component">
                <goa-form-item label="Grouping" labelSize="regular">
                  <goa-dropdown name="grouping" 
                  value="" 
                  matTooltip="Select HS digit grouping" 
                  matTooltipPosition="above" 
                  value="HS2" 
                  width="180px"
                  (_change)="onChange($event, 'grouping')"
                  >
                  <goa-dropdown-item value="HS2" label="HS 2 Digits"></goa-dropdown-item>
                  <goa-dropdown-item value="HS4" label="HS 4 Digits"></goa-dropdown-item>
                  <goa-dropdown-item value="HS6" label="HS 6 Digits"></goa-dropdown-item>
                  </goa-dropdown>
                </goa-form-item>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-4">
        <div class="row">
          <div class="col">


            <goa-form-item label="Chart Type" labelSize="small">
              <div class="modern-chart-toggles"
              
              >
                <mat-button-toggle-group 
                  name="chartType" 
                  aria-label="Chart Type" 
                  value="ProductSpace" 
                  (change)="onChartTypeChange($event)">
                  <mat-button-toggle value="ProductSpace">Product Space</mat-button-toggle>
                  <mat-button-toggle value="Feasible">Feasible</mat-button-toggle>
                  <mat-button-toggle value="Trends">Trends</mat-button-toggle>
                  <mat-button-toggle value="Exports">Exports</mat-button-toggle>
                  <mat-button-toggle value="ECI">ECI</mat-button-toggle>
                </mat-button-toggle-group>
              </div>
            </goa-form-item>
        </div>
        </div>
      </div>
    </div>

        <goa-spacer vspacing="m"></goa-spacer>
    <div class="row">
      <div class="col-12">
        <goa-divider></goa-divider>
      </div>
    </div>
    <goa-spacer vspacing="m"></goa-spacer>


    <!-- Second Row: Title + Stats + Controls -->
    <div class="row align-items-center space-between">
      <div class="col">
        <goa-text mt="none" mb="none" as="h4">
          Export Dashboard
        </goa-text>
      </div>

      <div class="col">
        <goa-text mt="none" mb="none" as="h5">
          Total Value: $2.4B
        </goa-text>
      </div>

      <div class="col">
        <goa-text mt="none" mb="none" as="h5">
          Number of Products: 1,247
        </goa-text>
      </div>

      <div class="col">
        <goa-button type="secondary" size="compact">
          <goa-icon name="filter" slot="prefix"></goa-icon>
          Filter
        </goa-button>
      </div>

      <div class="col">
        <goa-input name="search" type="search" placeholder="Search products..." width="200px"></goa-input>
      </div>
    </div>

    <goa-spacer vspacing="m"></goa-spacer>

    <!-- Third Row: Charts -->
    <div class="row" *ngIf="selectedChartType === 'ProductSpace'">
      <div class="col-12" style="position: relative;">
        
        <app-product-space-chart 
          #productSpaceChart
          [showGroupLabels]="showLabels"
          [customGroupLabels]="customLabels"
          [tooltipEnabled]="true"
          [highlightConnections]="true"
          (nodeSelected)="onNodeSelected($event)"
          (nodeHovered)="onNodeHovered($event)"
          (rowHighlight)="onRowHighlight($event)"
          >
        </app-product-space-chart>

        <!-- Floating Info Panel for Selected Node -->
        <div class="floating-info-panel" *ngIf="selectedNode">
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">Selected Product: {{selectedNode!.node.id}}</h6>
            </div>
            <div class="card-body p-3">
              <p class="mb-2"><strong>Cluster:</strong> {{selectedNode!.node.cluster_name}}</p>
              <p class="mb-2"><strong>Value:</strong> {{selectedNode!.data?.Value | number}}</p>
              <p class="mb-2"><strong>RCA:</strong> {{selectedNode!.data?.rca | number:'1.4-4'}}</p>
              <p class="mb-2"><strong>Description:</strong> {{selectedNode!.data?.description}}</p>
              <p class="mb-3"><strong>Industry:</strong> {{selectedNode!.data?.naics_description}}</p>
              <button class="btn btn-sm btn-secondary w-100" (click)="clearSelection()">Clear Selection</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional: Chart Statistics -->
    <div class="row" *ngIf="chartStats">
      <div class="col-12">
        <div class="card mt-3">
          <div class="card-body">
            <div class="row text-center">
              <div class="col-md-4">
                <h6>Total Value</h6>
                <p class="h5">{{chartStats.totalSum | number}}</p>
              </div>
              <div class="col-md-4">
                <h6>Products</h6>
                <p class="h5">{{chartStats.nodeCount}}</p>
              </div>
              <div class="col-md-4">
                <h6>Data Points</h6>
                <p class="h5">{{chartStats.dataCount}}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row" *ngIf="selectedChartType === 'Feasible'">
      <div class="col-12">
           <app-feasible-chart 
            #feasibleChart
            [showTooltips]="true"
            [enableIconFiltering]="true"
            [enableTracking]="true"
            >
        </app-feasible-chart>
        </div>  
    </div>

    <div class="row" *ngIf="selectedChartType === 'Trends'">
      <div class="col-12">
        <app-overtime-chart
          #overtimeChart
          [showDebugInfo]="true"
          [showTooltips]="true"
          [enableCategoryToggling]="true"
          [enableDataTable]="true">
        </app-overtime-chart>
      </div>  

    </div>

    <div class="row" *ngIf="selectedChartType === 'Exports'">
      <div class="col-12">
        <app-treemap-chart
        [enableZoomPan]="true"
        [showControls]="true"
        [showDebugInfo]="true">
      </app-treemap-chart>
      </div>
    </div>

    <div class="row" *ngIf="selectedChartType === 'ECI'">
      <div class="col-12">
        <app-eci-chart
          #eciChart
          [showControls]="true"
          [showStats]="true"
          [enableTooltips]="true"
          [enableLegend]="true"
          [chartWidth]="1440"
          [chartHeight]="650"
         >
        </app-eci-chart>
      </div>
    </div>

  </div>  

</goa-container>